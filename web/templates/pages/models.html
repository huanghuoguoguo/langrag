<div x-show="nav.isActive('models')" x-data="modelsPage()" class="content-section" x-cloak>
    <div class="section-header">
        <div>
            <h1>âš™ï¸ æ¨¡å‹é…ç½®</h1>
            <p class="subtitle">é…ç½® Embedding å’Œ LLM æ¨¡å‹</p>
        </div>
    </div>

    <div class="container">
        <!-- Embedder Section -->
        <div class="config-section">
            <h2 class="config-section-title">
                <span class="dot primary"></span>
                Embedding æ¨¡å‹
            </h2>

            <div class="config-grid">
                <!-- Embedder List -->
                <div class="card">
                    <h3>å·²é…ç½®åˆ—è¡¨</h3>
                    <div class="config-list" x-show="embedders.length === 0">
                        <p class="text-muted">æš‚æ— é…ç½®</p>
                    </div>
                    <div class="config-list" x-show="embedders.length > 0">
                        <template x-for="emb in embedders" :key="emb.name">
                            <div class="config-item">
                                <div>
                                    <div class="config-item-name" x-text="emb.name"></div>
                                    <div class="text-muted text-sm" x-text="emb.model"></div>
                                </div>
                                <span class="badge primary" x-text="emb.embedder_type"></span>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Embedder Form -->
                <div class="card">
                    <h3>æ·»åŠ æ–°é…ç½®</h3>
                    <div class="form-group">
                        <label>é…ç½®åç§° *</label>
                        <input type="text" x-model="embForm.name" placeholder="ä¾‹å¦‚ï¼šopenai-default">
                    </div>
                    <div class="form-group">
                        <label>ç±»å‹ *</label>
                        <select x-model="embForm.embedder_type" @change="onEmbTypeChange()">
                            <option value="openai">OpenAI å…¼å®¹ API</option>
                            <option value="seekdb">SeekDB å†…ç½®æ¨¡å‹</option>
                        </select>
                    </div>

                    <!-- SeekDB Info -->
                    <div class="info-box" x-show="isSeekDB">
                        <strong>SeekDB å†…ç½®æ¨¡å‹</strong><br>
                        <span class="text-muted">
                            æ¨¡å‹ï¼šall-MiniLM-L6-v2 (384ç»´)<br>
                            å®Œå…¨ç¦»çº¿ï¼Œæ— éœ€ API Key
                        </span>
                    </div>

                    <!-- OpenAI Fields -->
                    <template x-if="!isSeekDB">
                        <div>
                            <div class="form-group">
                                <label>Base URL *</label>
                                <input type="text" x-model="embForm.base_url" placeholder="https://api.openai.com/v1">
                            </div>
                            <div class="form-group">
                                <label>API Key *</label>
                                <input type="password" x-model="embForm.api_key" placeholder="sk-...">
                            </div>
                            <div class="form-group">
                                <label>Model Name *</label>
                                <input type="text" x-model="embForm.model" placeholder="text-embedding-3-small">
                            </div>
                        </div>
                    </template>

                    <button class="btn-primary" @click="saveEmbedder()" :disabled="embSaving">
                        <span x-show="!embSaving">ä¿å­˜ Embedder</span>
                        <span x-show="embSaving" class="loader"></span>
                    </button>
                </div>
            </div>
        </div>

        <!-- LLM Section -->
        <div class="config-section">
            <h2 class="config-section-title">
                <span class="dot success"></span>
                LLM (å¯¹è¯æ¨¡å‹)
            </h2>

            <div class="config-grid">
                <!-- LLM List -->
                <div class="card">
                    <h3>å·²é…ç½®åˆ—è¡¨</h3>
                    <div class="config-list" x-show="llms.length === 0">
                        <p class="text-muted">æš‚æ— é…ç½®</p>
                    </div>
                    <div class="config-list" x-show="llms.length > 0">
                        <template x-for="llm in llms" :key="llm.name">
                            <div class="config-item">
                                <div>
                                    <div class="config-item-name" x-text="llm.name"></div>
                                    <div class="text-muted text-sm" x-text="llm.model"></div>
                                </div>
                                <span class="badge success" x-text="'å¯ç”¨'"></span>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- LLM Form -->
                <div class="card">
                    <h3>æ·»åŠ æ–°é…ç½®</h3>
                    <div class="form-group">
                        <label>ä¾›åº”å•†</label>
                        <select x-model="llmForm.provider" @change="onLLMProviderChange()">
                            <option value="kimi">Moonshot AI (Kimi)</option>
                            <option value="custom">Custom (OpenAI å…¼å®¹)</option>
                            <option value="local">Local Model (GGUF)</option>
                            <option value="mock">ğŸ§ª Mock æµ‹è¯•æ¨¡å‹ (å¼€å‘ç”¨)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>é…ç½®åç§° *</label>
                        <input type="text" x-model="llmForm.name" placeholder="ä¾‹å¦‚ï¼škimi-default">
                    </div>

                    <!-- Remote Provider Fields -->
                    <template x-if="llmForm.provider !== 'local'">
                        <div>
                            <div class="form-group">
                                <label>Base URL *</label>
                                <input type="text" x-model="llmForm.base_url" placeholder="https://api.moonshot.cn/v1">
                            </div>
                            <div class="form-group">
                                <label>API Key *</label>
                                <input type="password" x-model="llmForm.api_key" placeholder="sk-...">
                            </div>
                            <div class="form-group">
                                <label>Model Name *</label>
                                <input type="text" x-model="llmForm.model" placeholder="moonshot-v1-8k">
                            </div>
                        </div>
                    </template>

                    <!-- Local Provider Fields -->
                    <template x-if="llmForm.provider === 'local'">
                        <div>
                            <div class="info-box">
                                <strong>ä½¿ç”¨å†…ç½®æœ¬åœ°æ¨¡å‹</strong><br>
                                <span class="text-muted">
                                    ä¼˜å…ˆè·¯å¾„ï¼š/home/yhh/models/qwen2-0_5b-instruct-q4_k_m.gguf<br>
                                    å¤‡é€‰è·¯å¾„ï¼š/home/yhh/models/qwen2.5-7b-instruct-q4_k_m.gguf<br>
                                    æ¨¡å‹ï¼šQwen2 0.5B Instruct (æ¨èç”¨äºæµ‹è¯•)
                                </span>
                            </div>
                            <p class="form-hint" style="font-size: 0.8em; color: #666; margin-top: 8px;">
                                <em>æ³¨æ„ï¼šç¡®ä¿æ¨¡å‹æ–‡ä»¶å·²ä¸‹è½½åˆ°æŒ‡å®šè·¯å¾„</em>
                            </p>
                        </div>
                    </template>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Temperature</label>
                            <input type="number" x-model.number="llmForm.temperature" step="0.1" min="0" max="2">
                        </div>
                        <div class="form-group">
                            <label>Max Tokens</label>
                            <input type="number" x-model.number="llmForm.max_tokens" step="128">
                        </div>
                    </div>

                    <button class="btn-primary" @click="saveLLM()" :disabled="llmSaving">
                        <span x-show="!llmSaving">ä¿å­˜ LLM</span>
                        <span x-show="llmSaving" class="loader"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>