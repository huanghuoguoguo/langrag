<div x-show="nav.isActive('models')" x-data="modelsPage()" class="content-section" x-cloak>
    <div class="section-header">
        <div>
            <h1>‚öôÔ∏è Ê®°ÂûãÈÖçÁΩÆ</h1>
            <p class="subtitle">ÈÖçÁΩÆ Embedding Âíå LLM Ê®°Âûã</p>
        </div>
    </div>

    <div class="container">
        <!-- Embedder Section -->
        <div class="config-section">
            <h2 class="config-section-title">
                <span class="dot primary"></span>
                Embedding Ê®°Âûã
            </h2>

            <div class="config-grid">
                <!-- Embedder List -->
                <div class="card">
                    <h3>Â∑≤ÈÖçÁΩÆÂàóË°®</h3>
                    <div class="config-list" x-show="embedders.length === 0">
                        <p class="text-muted">ÊöÇÊó†ÈÖçÁΩÆ</p>
                    </div>
                    <div class="config-list" x-show="embedders.length > 0">
                        <template x-for="emb in embedders" :key="emb.name">
                            <div class="config-item">
                                <div>
                                    <div class="config-item-name" x-text="emb.name"></div>
                                    <div class="text-muted text-sm" x-text="emb.model"></div>
                                </div>
                                <div class="config-actions" style="display:flex; gap:8px; align-items:center;">
                                    <span class="badge primary" x-text="emb.embedder_type"></span>
                                    <button class="btn-icon danger"
                                        @click="if(confirm('Á°ÆÂÆöÂà†Èô§?')) Alpine.store('models').deleteEmbedder(emb.name)"
                                        title="Âà†Èô§">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Embedder Form -->
                <div class="card">
                    <h3>Ê∑ªÂä†Êñ∞ÈÖçÁΩÆ</h3>
                    <div class="form-group">
                        <label>ÈÖçÁΩÆÂêçÁß∞ *</label>
                        <input type="text" x-model="embForm.name" placeholder="‰æãÂ¶ÇÔºöopenai-default">
                    </div>
                    <div class="form-group">
                        <label>Á±ªÂûã *</label>
                        <select x-model="embForm.embedder_type" @change="onEmbTypeChange()">
                            <option value="openai">OpenAI ÂÖºÂÆπ API</option>
                            <option value="seekdb">SeekDB ÂÜÖÁΩÆÊ®°Âûã</option>
                        </select>
                    </div>

                    <!-- SeekDB Info -->
                    <div class="info-box" x-show="isSeekDB">
                        <strong>SeekDB ÂÜÖÁΩÆÊ®°Âûã</strong><br>
                        <span class="text-muted">
                            Ê®°ÂûãÔºöall-MiniLM-L6-v2 (384Áª¥)<br>
                            ÂÆåÂÖ®Á¶ªÁ∫øÔºåÊó†ÈúÄ API Key
                        </span>
                    </div>

                    <!-- OpenAI Fields -->
                    <template x-if="!isSeekDB">
                        <div>
                            <div class="form-group">
                                <label>Base URL *</label>
                                <input type="text" x-model="embForm.base_url" placeholder="https://api.openai.com/v1">
                            </div>
                            <div class="form-group">
                                <label>API Key *</label>
                                <input type="password" x-model="embForm.api_key" placeholder="sk-...">
                            </div>
                            <div class="form-group">
                                <label>Model Name *</label>
                                <input type="text" x-model="embForm.model" placeholder="text-embedding-3-small">
                            </div>
                        </div>
                    </template>

                    <button class="btn-primary" @click="saveEmbedder()" :disabled="embSaving">
                        <span x-show="!embSaving">‰øùÂ≠ò Embedder</span>
                        <span x-show="embSaving" class="loader"></span>
                    </button>
                </div>
            </div>
        </div>

        <!-- LLM Section -->
        <div class="config-section">
            <h2 class="config-section-title">
                <span class="dot success"></span>
                LLM (ÂØπËØùÊ®°Âûã)
            </h2>

            <div class="config-grid">
                <!-- LLM List -->
                <div class="card">
                    <h3>Â∑≤ÈÖçÁΩÆÂàóË°®</h3>
                    <div class="config-list" x-show="llms.length === 0">
                        <p class="text-muted">ÊöÇÊó†ÈÖçÁΩÆ</p>
                    </div>
                    <div class="config-list" x-show="llms.length > 0">
                        <template x-for="llm in llms" :key="llm.name">
                            <div class="config-item">
                                <div>
                                    <div class="config-item-name" x-text="llm.name"></div>
                                    <div class="text-muted text-sm" x-text="llm.model"></div>
                                </div>
                                <div class="config-actions" style="display:flex; gap:8px; align-items:center;">
                                    <span class="badge success" x-text="'ÂèØÁî®'"></span>
                                    <button class="btn-icon danger"
                                        @click="if(confirm('Á°ÆÂÆöÂà†Èô§?')) Alpine.store('models').deleteLLM(llm.name)"
                                        title="Âà†Èô§">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- LLM Form -->
                <div class="card">
                    <h3>Ê∑ªÂä†Êñ∞ÈÖçÁΩÆ</h3>
                    <div class="form-group">
                        <label>‰æõÂ∫îÂïÜ</label>
                        <select x-model="llmForm.provider" @change="onLLMProviderChange()">
                            <option value="kimi">Moonshot AI (Kimi)</option>
                            <option value="custom">Custom (OpenAI ÂÖºÂÆπ)</option>
                            <option value="local">Local Model (GGUF)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ÈÖçÁΩÆÂêçÁß∞ *</label>
                        <input type="text" x-model="llmForm.name" placeholder="‰æãÂ¶ÇÔºökimi-default">
                    </div>

                    <!-- Remote Provider Fields -->
                    <template x-if="llmForm.provider !== 'local'">
                        <div>
                            <div class="form-group">
                                <label>Base URL *</label>
                                <input type="text" x-model="llmForm.base_url" placeholder="https://api.moonshot.cn/v1">
                            </div>
                            <div class="form-group">
                                <label>API Key *</label>
                                <input type="password" x-model="llmForm.api_key" placeholder="sk-...">
                            </div>
                            <div class="form-group">
                                <label>Model Name *</label>
                                <input type="text" x-model="llmForm.model" placeholder="moonshot-v1-8k">
                            </div>
                        </div>
                    </template>

                    <!-- Local Provider Fields -->
                    <template x-if="llmForm.provider === 'local'">
                        <div>
                            <div class="info-box">
                                <strong>‰ΩøÁî®ÂÜÖÁΩÆÊú¨Âú∞Ê®°Âûã</strong><br>
                                <span class="text-muted">
                                    ‰ºòÂÖàË∑ØÂæÑÔºö~/models/qwen2-0_5b-instruct-q4_k_m.gguf<br>
                                    Â§áÈÄâË∑ØÂæÑÔºö~/models/qwen2.5-7b-instruct-q4_k_m.gguf<br>
                                    Ê®°ÂûãÔºöQwen2 0.5B Instruct (Êé®ËçêÁî®‰∫éÊµãËØï)
                                </span>
                            </div>
                            <p class="form-hint" style="font-size: 0.8em; color: #666; margin-top: 8px;">
                                <em>Ê≥®ÊÑèÔºöÁ°Æ‰øùÊ®°ÂûãÊñá‰ª∂Â∑≤‰∏ãËΩΩÂà∞ÊåáÂÆöË∑ØÂæÑ</em>
                            </p>
                        </div>
                    </template>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Temperature</label>
                            <input type="number" x-model.number="llmForm.temperature" step="0.1" min="0" max="2">
                        </div>
                        <div class="form-group">
                            <label>Max Tokens</label>
                            <input type="number" x-model.number="llmForm.max_tokens" step="128">
                        </div>
                    </div>

                    <button class="btn-primary" @click="saveLLM()" :disabled="llmSaving">
                        <span x-show="!llmSaving">‰øùÂ≠ò LLM</span>
                        <span x-show="llmSaving" class="loader"></span>
                    </button>
                </div>
            </div>
        </div>


    </div>
</div>